<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¬Ø± Ø§Ù„Ù†Ø±Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ ğŸ²</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background: #000; color: #fff; font-family: 'Cairo', sans-serif; text-align: center; margin: 0; overflow-x: hidden; }
        
        .top-bar { display: flex; justify-content: space-between; padding: 15px; background: #111; border-bottom: 2px solid #d4af37; align-items: center; }
        .balance-chip { background: #1a1a1a; border: 1px solid #d4af37; padding: 5px 15px; border-radius: 10px; color: #d4af37; font-weight: 900; font-size: 18px; }
        .back-link { color: #d4af37; text-decoration: none; font-size: 14px; border: 1px solid #d4af37; padding: 4px 10px; border-radius: 5px; }

        .game-title { margin-top: 20px; font-size: 24px; color: #fff; }
        .multiplier-info { color: #d4af37; font-size: 14px; margin-bottom: 20px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Ø±Ø¯ */
        .dice-area { height: 180px; display: flex; justify-content: center; align-items: center; margin: 20px 0; }
        .dice { 
            width: 100px; height: 100px; background: #fff; color: #000; 
            font-size: 60px; display: flex; align-items: center; justify-content: center; 
            border-radius: 20px; box-shadow: 0 0 30px #d4af37; 
            transition: transform 0.1s; font-weight: 900;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        .num-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 320px; margin: 0 auto 20px; }
        .num-btn { 
            background: #111; border: 2px solid #333; color: #fff; 
            padding: 15px; border-radius: 15px; font-size: 22px; 
            cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        .num-btn.active { border-color: #d4af37; background: #d4af37; color: #000; transform: scale(1.05); }

        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±Ù‡Ø§Ù† */
        .bet-select { background: #111; color: #fff; border: 1px solid #d4af37; padding: 10px; border-radius: 10px; width: 120px; font-size: 18px; margin-bottom: 20px; }

        .play-btn { 
            background: linear-gradient(180deg, #d4af37, #8a6d3b); color: #000; 
            width: 85%; max-width: 350px; padding: 18px; border-radius: 50px; 
            font-size: 24px; font-weight: 900; border: none; cursor: pointer; 
            box-shadow: 0 5px 15px rgba(212,175,55,0.4);
        }
        .play-btn:disabled { background: #333; color: #777; cursor: not-allowed; }
    </style>
</head>
<body>

    <audio id="sndRoll" src="https://www.soundjay.com/misc/sounds/dice-roll-1.mp3"></audio>
    <audio id="sndWin" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>

    <div class="top-bar">
        <div class="balance-chip">ğŸ’° <span id="uBalance">0</span></div>
        <a href="index.html" class="back-link">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
    </div>

    <div class="game-title">ØªÙˆÙ‚Ø¹ Ø±Ù‚Ù… Ø§Ù„Ù†Ø±Ø¯ ğŸ²</div>
    <div class="multiplier-info">Ø§Ø±Ø¨Ø­ 5 Ø£Ø¶Ø¹Ø§Ù Ø±Ù‡Ø§Ù†Ùƒ Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„ØµØ­ÙŠØ­!</div>

    <div class="dice-area">
        <div id="diceDisplay" class="dice">?</div>
    </div>

    <div class="num-grid">
        <div class="num-btn" onclick="selectNumber(1, this)">1</div>
        <div class="num-btn" onclick="selectNumber(2, this)">2</div>
        <div class="num-btn" onclick="selectNumber(3, this)">3</div>
        <div class="num-btn" onclick="selectNumber(4, this)">4</div>
        <div class="num-btn" onclick="selectNumber(5, this)">5</div>
        <div class="num-btn" onclick="selectNumber(6, this)">6</div>
    </div>

    <div>
        <span style="color: #888;">Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù†:</span><br>
        <select id="betVal" class="bet-select">
            <option value="100">100</option>
            <option value="500">500</option>
            <option value="1000">1000</option>
            <option value="5000">5000</option>
        </select>
    </div>

    <button class="play-btn" id="rollBtn" onclick="playDice()">Ø¥Ø±Ù…Ù Ø§Ù„Ù†Ø±Ø¯ ğŸ²</button>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');
        let score = 0, selectedNum = 0, isRolling = false;

        if(!pName) window.location.href="index.html";

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø±ØµÙŠØ¯
        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('uBalance').innerText = score; }
        });

        function selectNumber(num, el) {
            if(isRolling) return;
            selectedNum = num;
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function playDice() {
            let bet = parseInt(document.getElementById('betVal').value);
            if (selectedNum === 0) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø£ÙˆÙ„Ø§Ù‹!");
            if (score < bet) return alert("Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ!");
            if (isRolling) return;

            isRolling = true;
            document.getElementById('rollBtn').disabled = true;
            document.getElementById('sndRoll').play();

            // Ø®ØµÙ… Ø§Ù„Ø±Ù‡Ø§Ù†
            db.ref('players_logs/' + pName).update({ score: score - bet });

            let diceEl = document.getElementById('diceDisplay');
            let counter = 0;
            
            // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ØªØ¯Ø­Ø±Ø¬
            let interval = setInterval(() => {
                let tempNum = Math.floor(Math.random() * 6) + 1;
                diceEl.innerText = tempNum;
                diceEl.style.transform = `rotate(${Math.random() * 20 - 10}deg) scale(1.1)`;
                counter++;

                if (counter > 15) {
                    clearInterval(interval);
                    let finalNum = Math.floor(Math.random() * 6) + 1;
                    diceEl.innerText = finalNum;
                    diceEl.style.transform = `rotate(0deg) scale(1)`;
                    finishGame(finalNum, bet);
                }
            }, 80);
        }

        function finishGame(result, bet) {
            isRolling = false;
            document.getElementById('rollBtn').disabled = false;

            if (result === selectedNum) {
                let winAmount = bet * 5;
                db.ref('players_logs/' + pName).update({ score: score + winAmount });
                document.getElementById('sndWin').play();
                alert(`ğŸŠ Ù…Ø¨Ø±ÙˆÙƒ! Ø¸Ù‡Ø± Ø§Ù„Ø±Ù‚Ù… ${result}. Ø±Ø¨Ø­Øª ${winAmount} Ù†Ù‚Ø·Ø©!`);
            } else {
                alert(`âŒ Ø­Ø¸ Ø£ÙˆÙØ±! Ø§Ù„Ø±Ù‚Ù… ÙƒØ§Ù† ${result}.`);
            }
        }
    </script>
</body>
</html>
