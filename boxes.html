<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ù„ÙƒÙŠ ğŸ’</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background: #050505; color: #fff; font-family: 'Cairo', sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        .top-bar { display: flex; justify-content: space-between; padding: 15px; background: #111; border-bottom: 2px solid #d4af37; }
        .balance-chip { background: #000; border: 1px solid #d4af37; padding: 5px 15px; border-radius: 20px; color: #d4af37; font-weight: 900; }
        
        .game-status { margin: 20px 0; font-size: 18px; color: #888; }
        .multi-tag { font-size: 30px; font-weight: 900; color: #d4af37; text-shadow: 0 0 10px rgba(212,175,55,0.5); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù„ØºØ§Ù… */
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 350px; margin: 0 auto; padding: 10px; }
        .cell { 
            aspect-ratio: 1/1; background: linear-gradient(145deg, #222, #111); 
            border-radius: 12px; border: 1px solid #333; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; transition: 0.2s; 
        }
        .cell:active { transform: scale(0.9); }
        .cell.gold { background: #d4af37; color: #000; box-shadow: 0 0 15px #d4af37; border-color: #fff; }
        .cell.bomb { background: #ff4444; color: #fff; border-color: #ff0000; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { 
            background: #111; padding: 25px; border-radius: 30px 30px 0 0; 
            position: fixed; bottom: 0; width: 100%; max-width: 500px; 
            left: 50%; transform: translateX(-50%); border-top: 2px solid #d4af37;
        }
        .bet-input { 
            background: #000; border: 1px solid #444; color: #fff; 
            padding: 12px; width: 70%; border-radius: 10px; 
            text-align: center; font-size: 20px; font-weight: bold; margin-bottom: 15px;
        }
        .btn-action { 
            background: linear-gradient(180deg, #d4af37, #8a6d3b); color: #000; 
            width: 90%; padding: 18px; border-radius: 50px; 
            font-size: 22px; font-weight: 900; border: none; cursor: pointer; 
        }
        .btn-cash { background: #27ae60; color: #fff; display: none; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="balance-chip">ğŸ’° <span id="uBal">0</span></div>
        <a href="index.html" style="color:#d4af37; text-decoration:none; font-weight:900;">ğŸ”™ Ø®Ø±ÙˆØ¬</a>
    </div>

    <div class="game-status">Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø­Ø§Ù„ÙŠ: <br> <span class="multi-tag" id="displayMulti">x1.00</span></div>

    <div class="grid" id="mineGrid"></div>

    <div class="controls">
        <input type="number" id="betAmt" class="bet-input" value="100">
        <button id="startBtn" class="btn-action" onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ğŸ’</button>
        <button id="cashBtn" class="btn-action btn-cash" onclick="cashOut()">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ğŸ’°</button>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');
        
        let score = 0, bet = 0, isPlaying = false, mines = [], foundGold = 0;
        
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ---
        const bombCount = 5; // Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ (ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø²Ø§Ø¯Øª ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©)
        const profitMargin = 0.85; // Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ£Ø®Ø° 15% Ø¹Ù…ÙˆÙ„Ø© Ù…Ø®ÙÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­

        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('uBal').innerText = score; }
        });

        function createGrid() {
            const grid = document.getElementById('mineGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => reveal(i, cell);
                grid.appendChild(cell);
            }
        }

        function startGame() {
            bet = parseInt(document.getElementById('betAmt').value);
            if (score < bet || bet <= 0) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ!");
            
            db.ref('players_logs/' + pName).update({ score: score - bet });
            
            isPlaying = true; foundGold = 0; mines = [];
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            while(mines.length < bombCount) {
                let r = Math.floor(Math.random() * 25);
                if(!mines.includes(r)) mines.push(r);
            }
            
            createGrid();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashBtn').style.display = 'block';
            updateUI();
        }

        function reveal(i, cell) {
            if (!isPlaying || cell.classList.contains('gold')) return;

            // --- Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø±Ø¨Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø© (Ù„ØµØ§Ù„Ø­Ùƒ) ---
            let winChance = 0.70; // Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© 70%
            
            // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ±Ø¨Ø­ ÙƒØ«ÙŠØ±Ø§Ù‹ Ø£Ùˆ Ø±Ø§Ù‡Ù† Ø¨Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ±ØŒ Ù‚Ù„Ù„ Ù†Ø³Ø¨Ø© Ø­Ø¸Ù‡
            if (foundGold > 3) winChance = 0.40; 
            if (bet >= 1000) winChance = 0.30; 

            let isBomb = mines.includes(i) || (Math.random() > winChance);

            if (isBomb) {
                cell.innerHTML = 'ğŸ’£'; cell.classList.add('bomb');
                gameOver();
            } else {
                cell.innerHTML = 'ğŸ’'; cell.classList.add('gold');
                foundGold++;
                updateUI();
            }
        }

        function updateUI() {
            // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±Ø¨Ø­ Ù…ÙˆØ²ÙˆÙ†Ø© ØªØ¹Ø·ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙØ¶Ù„ÙŠØ©
            let multi = (1 + (foundGold * 0.35)) * profitMargin;
            if (foundGold === 0) multi = 1.0;
            document.getElementById('displayMulti').innerText = `x${multi.toFixed(2)}`;
            document.getElementById('cashBtn').innerText = `Ø³Ø­Ø¨ ${(bet * multi).toFixed(0)} ğŸ’°`;
        }

        function cashOut() {
            let multi = (1 + (foundGold * 0.35)) * profitMargin;
            let win = Math.floor(bet * multi);
            db.ref('players_logs/' + pName).update({ score: score + win });
            alert(`âœ… ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${win}`);
            reset();
        }

        function gameOver() {
            isPlaying = false;
            alert("ğŸ’¥ Ø§Ù†ÙØ¬Ø±Øª Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©! Ø¶Ø§Ø¹Øª Ø§Ù„Ø£Ù…ÙˆØ§Ù„.");
            setTimeout(reset, 1000);
        }

        function reset() {
            isPlaying = false;
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('cashBtn').style.display = 'none';
            document.getElementById('displayMulti').innerText = 'x1.00';
            createGrid();
        }

        createGrid();
    </script>
</body>
</html>
