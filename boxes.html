<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ğŸ’</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background: #000; color: #fff; font-family: 'Cairo', sans-serif; text-align: center; margin: 0; }
        .top-bar { display: flex; justify-content: space-between; padding: 15px; background: #111; border-bottom: 2px solid #d4af37; }
        .balance-chip { background: #1a1a1a; border: 1px solid #d4af37; padding: 5px 15px; border-radius: 10px; color: #d4af37; font-weight: 900; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 350px; margin: 20px auto; padding: 10px; }
        .cell { aspect-ratio: 1/1; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .cell.gold { background: #d4af37; color: #000; box-shadow: 0 0 10px #d4af37; }
        .cell.bomb { background: #ff4444; }
        .controls { background: #111; padding: 20px; border-top: 2px solid #d4af37; position: fixed; bottom: 0; width: 100%; max-width: 400px; left: 50%; transform: translateX(-50%); }
        .bet-input { background: #000; border: 1px solid #444; color: #fff; padding: 10px; width: 80%; border-radius: 10px; text-align: center; font-size: 18px; margin-bottom: 10px; }
        .btn { background: #d4af37; color: #000; width: 100%; padding: 15px; border-radius: 50px; font-weight: 900; border: none; cursor: pointer; font-size: 18px; }
        .btn-cash { background: #27ae60; color: #fff; display: none; }
        .info { font-size: 14px; color: #888; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="balance-chip">ğŸ’° <span id="uBal">0</span></div>
        <a href="index.html" style="color:#d4af37; text-decoration:none;">Ø®Ø±ÙˆØ¬</a>
    </div>

    <h2 style="margin-top:20px; color:#d4af37;">Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ù„ÙƒÙŠ</h2>
    <div id="multiDisplay" style="font-size:24px; font-weight:900;">x1.00</div>
    <div class="info">ÙŠØªÙ… Ø®ØµÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù† Ù…Ø¹ ÙƒÙ„ Ø¶ØºØ·Ø© âš ï¸</div>

    <div class="grid" id="mineGrid"></div>

    <div class="controls">
        <input type="number" id="betAmt" class="bet-input" value="100">
        <button id="startBtn" class="btn" onclick="startNewGame()">ÙØªØ­ Ø§Ù„Ù…Ù†Ø¬Ù…</button>
        <button id="cashBtn" class="btn btn-cash" onclick="cashOut()">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø¹Ø§Ø¦Ø¯ ÙƒØ§Ù…Ù„)</button>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');

        let score = 0, bet = 0, isPlaying = false, mines = [], foundGold = 0, totalPaidInRound = 0;

        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('uBal').innerText = score; }
        });

        function createGrid() {
            const grid = document.getElementById('mineGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.onclick = () => reveal(i, cell);
                grid.appendChild(cell);
            }
        }

        function startNewGame() {
            bet = parseInt(document.getElementById('betAmt').value);
            if (score < bet || bet <= 0) return alert("Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ø§ ÙŠÙƒÙÙŠ Ù„Ù„Ø±Ù‡Ø§Ù†!");
            
            isPlaying = true; foundGold = 0; totalPaidInRound = 0; mines = [];
            while(mines.length < 4) { // Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„
                let r = Math.floor(Math.random() * 25);
                if(!mines.includes(r)) mines.push(r);
            }
            createGrid();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashBtn').style.display = 'block';
            document.getElementById('multiDisplay').innerText = "x1.00";
        }

        function reveal(i, cell) {
            if (!isPlaying || cell.classList.contains('gold')) return;

            // --- Ø§Ù„Ø®ØµÙ… Ø¹Ù†Ø¯ ÙƒÙ„ Ø¶ØºØ·Ø© ---
            if (score < bet) return alert("Ù†ÙØ° Ø±ØµÙŠØ¯Ùƒ! Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø£ÙƒØ«Ø±.");
            totalPaidInRound += bet; // Ù†Ø¬Ù…Ø¹ Ù…Ø§ Ø¯ÙØ¹Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©
            db.ref('players_logs/' + pName).update({ score: score - bet });

            // Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ù„ØµØ§Ù„Ø­Ùƒ (Ù†Ø³Ø¨Ø© Ø§Ù†ÙØ¬Ø§Ø± ØªØ²ÙŠØ¯ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª)
            let winChance = (foundGold > 3) ? 0.3 : 0.7;

            if (mines.includes(i) || Math.random() > winChance) {
                cell.innerHTML = 'ğŸ’£'; cell.classList.add('bomb');
                gameOver();
            } else {
                cell.innerHTML = 'ğŸ’'; cell.classList.add('gold');
                foundGold++;
                updateMulti();
            }
        }

        function updateMulti() {
            // Ø§Ù„Ù…Ø¶Ø§Ø¹Ù ÙŠØ²ÙŠØ¯ Ø¨Ù†Ø³Ø¨Ø© Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø±
            let multi = 1 + (foundGold * 0.5); 
            document.getElementById('multiDisplay').innerText = "x" + multi.toFixed(2);
            // Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ù‡Ùˆ (Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø§ Ø¯ÙØ¹Ù‡ ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø© * Ø§Ù„Ù…Ø¶Ø§Ø¹Ù)
            let potentialWin = Math.floor(totalPaidInRound * multi);
            document.getElementById('cashBtn').innerText = `Ø³Ø­Ø¨ ${potentialWin} ğŸ’°`;
        }

        function cashOut() {
            let multi = 1 + (foundGold * 0.5);
            let win = Math.floor(totalPaidInRound * multi);
            db.ref('players_logs/' + pName).update({ score: score + win });
            alert(`âœ… ØªÙ… Ø§Ù„Ø³Ø­Ø¨! Ø¹Ø§Ø¯ Ù„Ùƒ ÙƒÙ„ Ù…Ø§ Ø¯ÙØ¹ØªÙ‡ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${win}`);
            resetGame();
        }

        function gameOver() {
            isPlaying = false;
            alert("ğŸ’¥ Ø§Ù†ÙØ¬Ø§Ø±! Ø®Ø³Ø±Øª ÙƒÙ„ Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„ØªÙŠ Ø¯ÙØ¹ØªÙ‡Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©.");
            setTimeout(resetGame, 1500);
        }

        function resetGame() {
            isPlaying = false;
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('cashBtn').style.display = 'none';
            createGrid();
        }

        createGrid();
    </script>
</body>
</html>
let r = Math.floor(Math.random() * 25);
                if(!mines.includes(r)) mines.push(r);
            }
            
            createGrid();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashBtn').style.display = 'block';
            updateUI();
        }

        function reveal(i, cell) {
            if (!isPlaying || cell.classList.contains('gold')) return;

            // --- Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø±Ø¨Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø© (Ù„ØµØ§Ù„Ø­Ùƒ) ---
            let winChance = 0.70; // Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© 70%
            
            // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ±Ø¨Ø­ ÙƒØ«ÙŠØ±Ø§Ù‹ Ø£Ùˆ Ø±Ø§Ù‡Ù† Ø¨Ù…Ø¨Ù„Øº ÙƒØ¨ÙŠØ±ØŒ Ù‚Ù„Ù„ Ù†Ø³Ø¨Ø© Ø­Ø¸Ù‡
            if (foundGold > 3) winChance = 0.40; 
            if (bet >= 1000) winChance = 0.30; 

            let isBomb = mines.includes(i) || (Math.random() > winChance);

            if (isBomb) {
                cell.innerHTML = 'ğŸ’£'; cell.classList.add('bomb');
                gameOver();
            } else {
                cell.innerHTML = 'ğŸ’'; cell.classList.add('gold');
                foundGold++;
                updateUI();
            }
        }

        function updateUI() {
            // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±Ø¨Ø­ Ù…ÙˆØ²ÙˆÙ†Ø© ØªØ¹Ø·ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙØ¶Ù„ÙŠØ©
            let multi = (1 + (foundGold * 0.35)) * profitMargin;
            if (foundGold === 0) multi = 1.0;
            document.getElementById('displayMulti').innerText = `x${multi.toFixed(2)}`;
            document.getElementById('cashBtn').innerText = `Ø³Ø­Ø¨ ${(bet * multi).toFixed(0)} ğŸ’°`;
        }

        function cashOut() {
            let multi = (1 + (foundGold * 0.35)) * profitMargin;
            let win = Math.floor(bet * multi);
            db.ref('players_logs/' + pName).update({ score: score + win });
            alert(`âœ… ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${win}`);
            reset();
        }

        function gameOver() {
            isPlaying = false;
            alert("ğŸ’¥ Ø§Ù†ÙØ¬Ø±Øª Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©! Ø¶Ø§Ø¹Øª Ø§Ù„Ø£Ù…ÙˆØ§Ù„.");
            setTimeout(reset, 1000);
        }

        function reset() {
            isPlaying = false;
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('cashBtn').style.display = 'none';
            document.getElementById('displayMulti').innerText = 'x1.00';
            createGrid();
        }

        createGrid();
    </script>
</body>
</html>
