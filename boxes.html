<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¬Ù… Ø§Ù„Ø°Ù‡Ø¨ ğŸ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background: #000; color: #fff; font-family: 'Cairo', sans-serif; text-align: center; margin: 0; padding-bottom: 50px; }
        .header { padding: 20px; background: #111; border-bottom: 2px solid #d4af37; margin-bottom: 20px; }
        .balance-box { font-size: 24px; color: #d4af37; font-weight: 900; margin-bottom: 10px; }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ */
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 350px; margin: 20px auto; padding: 10px; }
        .box { width: 75px; height: 75px; background: #222; border: 2px solid #444; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: 0.3s; }
        .box.open { background: #111; border-color: #d4af37; cursor: default; }
        .box.bomb { background: #c0392b; }
        .box.win { background: #27ae60; }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { background: #0d0d0d; padding: 20px; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #333; }
        .bet-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 400px; margin: 0 auto 15px; }
        .btn-opt { background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-opt.active { background: #d4af37; color: #000; font-weight: bold; }
        .btn-play { background: linear-gradient(180deg, #d4af37, #8a6d3b); color: #000; padding: 15px 50px; border-radius: 30px; border: none; font-size: 20px; font-weight: bold; cursor: pointer; width: 80%; }
        .btn-cashout { background: #27ae60; color: #fff; display: none; }
        
        .back-link { position: absolute; top: 15px; right: 15px; color: #d4af37; text-decoration: none; border: 1px solid #d4af37; padding: 5px 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back-link">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
        <h1>ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø­Ø¸ ğŸ</h1>
        <div class="balance-box">ğŸ’° <span id="userBalance">0</span></div>
    </div>

    <div id="status" style="color: #888;">Ø§Ø®ØªØ± Ø±Ù‡Ø§Ù†Ùƒ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</div>
    
    <div class="grid" id="gameGrid">
        </div>

    <div class="controls">
        <div class="bet-btns" id="betBtns">
            <div class="btn-opt" onclick="setBet(50, this)">50</div>
            <div class="btn-opt active" onclick="setBet(100, this)">100</div>
            <div class="btn-opt" onclick="setBet(500, this)">500</div>
        </div>
        <button class="btn-play" id="actionBtn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ğŸ®</button>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');
        let score = 0, currentBet = 100, isPlaying = false, multiplier = 1.0, openedCount = 0;
        let bombs = [];

        if(!pName) window.location.href="index.html";

        // Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ­Ø¯
        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('userBalance').innerText = score; }
        });

        function setBet(amt, el) {
            if(isPlaying) return;
            currentBet = amt;
            document.querySelectorAll('.btn-opt').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function createGrid() {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = "";
            for(let i=0; i<16; i++) {
                let box = document.createElement('div');
                box.className = "box";
                box.innerHTML = "ğŸ“¦";
                box.onclick = () => openBox(i, box);
                grid.appendChild(box);
            }
        }

        function startGame() {
            if(score < currentBet) return alert("Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ!");
            isPlaying = true; openedCount = 0; multiplier = 1.0;
            db.ref('players_logs/'+pName).update({score: score - currentBet});
            
            // ØªÙˆØ²ÙŠØ¹ 3 Ù‚Ù†Ø§Ø¨Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            bombs = [];
            while(bombs.length < 3) {
                let r = Math.floor(Math.random() * 16);
                if(!bombs.includes(r)) bombs.push(r);
            }

            createGrid();
            document.getElementById('actionBtn').innerText = "Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (0)";
            document.getElementById('actionBtn').style.display = "none";
            document.getElementById('betBtns').style.opacity = "0.3";
            document.getElementById('status').innerText = "Ø§Ø­Ø°Ø± Ù…Ù† Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„! Ø§ÙØªØ­ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚...";
        }

        function openBox(index, el) {
            if(!isPlaying || el.classList.contains('open')) return;

            el.classList.add('open');
            if(bombs.includes(index)) {
                // Ø®Ø³Ø§Ø±Ø©
                el.classList.add('bomb');
                el.innerHTML = "ğŸ’£";
                gameOver(false);
            } else {
                // Ø±Ø¨Ø­
                openedCount++;
                multiplier += 0.4; // ÙŠØ²ÙŠØ¯ Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ ÙƒÙ„ ØµÙ†Ø¯ÙˆÙ‚
                el.classList.add('win');
                el.innerHTML = "ğŸ’";
                
                let currentWin = Math.floor(currentBet * multiplier);
                document.getElementById('actionBtn').style.display = "inline-block";
                document.getElementById('actionBtn').innerText = `Ø³Ø­Ø¨ Ø£Ø±Ø¨Ø§Ø­Ùƒ (${currentWin})`;
                document.getElementById('actionBtn').onclick = cashOut;
            }
        }

        function cashOut() {
            let winAmount = Math.floor(currentBet * multiplier);
            db.ref('players_logs/'+pName).update({score: score + winAmount});
            alert("Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª " + winAmount + " Ù†Ù‚Ø·Ø© âœ…");
            resetUI();
        }

        function gameOver(win) {
            isPlaying = false;
            if(!win) {
                alert("Ù„Ù„Ø£Ø³Ù Ø§Ù†ÙØ¬Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚! Ø®Ø³Ø±Øª Ø§Ù„Ø±Ù‡Ø§Ù† ğŸ’¥");
                // ÙƒØ´Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„
                const boxes = document.querySelectorAll('.box');
                bombs.forEach(b => {
                    boxes[b].classList.add('bomb');
                    boxes[b].innerHTML = "ğŸ’£";
                });
            }
            setTimeout(resetUI, 2000);
        }

        function resetUI() {
            isPlaying = false;
            document.getElementById('actionBtn').innerText = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ğŸ®";
            document.getElementById('actionBtn').style.display = "inline-block";
            document.getElementById('actionBtn').onclick = startGame;
            document.getElementById('betBtns').style.opacity = "1";
            document.getElementById('status').innerText = "Ø§Ø®ØªØ± Ø±Ù‡Ø§Ù†Ùƒ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨";
            createGrid();
        }

        createGrid(); // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    </script>
</body>
</html>
