<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ù†Ø¬Ù… | PLATINUM ROYAL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { background: #000; color: #fff; font-family: 'Cairo', sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .game-header { padding: 20px; background: #0a0a0a; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .balance-display { color: #ffcc33; font-weight: 900; font-size: 18px; }
        .back-link { color: #777; text-decoration: none; font-size: 14px; border: 1px solid #333; padding: 5px 10px; border-radius: 5px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; padding: 15px; max-width: 350px; margin: 20px auto; }
        .cell { aspect-ratio: 1; background: #1a1a1a; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; border: 1px solid #333; transition: 0.2s; }
        .cell.open { background: #252525; border-color: #444; }
        .cell.diamond { color: #00ff44; text-shadow: 0 0 10px #00ff44; border-color: #00ff44; }
        .cell.bomb { color: #ff4444; text-shadow: 0 0 10px #ff4444; border-color: #ff4444; }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .game-controls { padding: 10px; background: #0a0a0a; border-radius: 20px; margin: 0 20px; border: 1px solid #222; }
        input { background: #000; border: 1px solid #ffcc33; color: #fff; padding: 12px; border-radius: 10px; width: 60%; text-align: center; font-size: 18px; margin-bottom: 15px; outline: none; }
        .btns-row { display: flex; gap: 10px; justify-content: center; padding: 0 20px; }
        button { flex: 1; padding: 12px; border-radius: 10px; font-weight: bold; font-family: 'Cairo'; border: none; cursor: pointer; font-size: 16px; }
        #startBtn { background: #ffcc33; color: #000; }
        #cashoutBtn { background: #00ff44; color: #000; display: none; }
        
        .status-msg { margin: 15px; font-size: 14px; color: #aaa; min-height: 20px; }
    </style>
</head>
<body>

    <div class="game-header">
        <a href="index.html" class="back-link">â¬… Ø±Ø¬ÙˆØ¹</a>
        <div class="balance-display">Ø±ØµÙŠØ¯Ùƒ: <span id="userScore">0</span></div>
    </div>

    <h2 style="color: #ffcc33; margin-top: 20px;">â›ï¸ Ù…Ù†Ø¬Ù… Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…</h2>

    <div class="game-controls">
        <p style="font-size: 12px; color: #777;">Ø­Ø¯Ø¯ Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù†</p>
        <input type="number" id="betInput" value="1000" min="100">
        <div class="btns-row">
            <button id="startBtn" onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ†</button>
            <button id="cashoutBtn" onclick="cashout()">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (0)</button>
        </div>
    </div>

    <div class="status-msg" id="statusMsg">Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù† ÙˆØ§Ø¶ØºØ· Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨</div>

    <div class="grid" id="grid"></div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ·Ø¨ÙŠÙ‚Ùƒ)
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const pId = localStorage.getItem('pId');
        let currentBalance = 0;
        let isPlaying = false;
        let bombs = [];
        let diamondsCount = 0;
        let currentBet = 0;

        // Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯
        db.ref('players_logs/' + pId).on('value', (s) => {
            if(s.exists()){
                currentBalance = s.val().score;
                document.getElementById('userScore').innerText = currentBalance.toLocaleString();
            }
        });

        function createGrid() {
            const gridDiv = document.getElementById('grid');
            gridDiv.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.onclick = () => clickCell(i, cell);
                gridDiv.appendChild(cell);
            }
        }

        function startGame() {
            currentBet = parseInt(document.getElementById('betInput').value);
            if (currentBet > currentBalance || currentBet < 100) {
                alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ Ø£Ùˆ Ø§Ù„Ø±Ù‡Ø§Ù† Ù‚Ù„ÙŠÙ„ Ø¬Ø¯Ø§Ù‹!");
                return;
            }

            // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Firebase
            db.ref('players_logs/' + pId + '/score').set(currentBalance - currentBet);

            isPlaying = true;
            diamondsCount = 0;
            bombs = [];
            while(bombs.length < 3) { // 3 Ù‚Ù†Ø§Ø¨Ù„ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
                let r = Math.floor(Math.random() * 25);
                if(!bombs.includes(r)) bombs.push(r);
            }

            createGrid();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashoutBtn').style.display = 'block';
            document.getElementById('cashoutBtn').innerText = "Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (0)";
            document.getElementById('statusMsg').innerText = "ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨.. Ø§Ø­Ø°Ø± Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„!";
        }

        function clickCell(index, cell) {
            if (!isPlaying || cell.classList.contains('open')) return;

            cell.classList.add('open');
            if (bombs.includes(index)) {
                cell.innerHTML = "ğŸ’£";
                cell.classList.add('bomb');
                endGame(false);
            } else {
                cell.innerHTML = "ğŸ’";
                cell.classList.add('diamond');
                diamondsCount++;
                let profit = calculateProfit();
                document.getElementById('cashoutBtn').innerText = `Ø³Ø­Ø¨ ${profit.toLocaleString()}`;
                document.getElementById('statusMsg').innerText = `Ù„Ù‚Ø¯ ÙˆØ¬Ø¯Øª ${diamondsCount} Ù…Ù† Ø§Ù„Ø£Ù„Ù…Ø§Ø³!`;
            }
        }

        function calculateProfit() {
            // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±Ø¨Ø­ Ø¨Ø³ÙŠØ·Ø©: ÙƒÙ„ Ø£Ù„Ù…Ø§Ø³Ø© ØªØ²ÙŠØ¯ 25% Ù…Ù† Ø§Ù„Ø±Ù‡Ø§Ù†
            return Math.floor(currentBet * (1 + (diamondsCount * 0.25)));
        }

        function cashout() {
            if (!isPlaying || diamondsCount === 0) return;
            let finalWin = calculateProfit();
            db.ref('players_logs/' + pId + '/score').set(currentBalance + finalWin);
            alert("Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª: " + finalWin);
            endGame(true);
        }

        function endGame(win) {
            isPlaying = false;
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('cashoutBtn').style.display = 'none';
            if (!win) document.getElementById('statusMsg').innerText = "Ù„Ù„Ø£Ø³Ù! Ø§Ù†ÙØ¬Ø±Øª Ø§Ù„Ù‚Ù†Ø¨Ù„Ø© ÙˆØ®Ø³Ø±Øª Ø§Ù„Ø±Ù‡Ø§Ù†.";
            
            // ÙƒØ´Ù Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„
            bombs.forEach(b => {
                document.querySelector(`[data-index="${b}"]`).innerHTML = "ğŸ’£";
            });
        }

        createGrid();
    </script>
</body>
</html>
