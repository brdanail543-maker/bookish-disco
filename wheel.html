<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ¡</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Cairo', sans-serif; margin: 0; text-align: center; overflow: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .top-bar { display: flex; justify-content: space-between; padding: 15px; align-items: center; background: #111; border-bottom: 1px solid #333; }
        .balance-chip { background: #1a1a1a; border: 1px solid #d4af37; padding: 5px 15px; border-radius: 10px; color: #d4af37; font-weight: bold; font-size: 18px; }
        .user-id { color: #d4af37; font-weight: bold; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø¬Ù„Ø© Ù…Ø¹ Ø§Ù„Ø³Ù‡Ù… */
        .wheel-box { position: relative; margin: 30px auto; width: 340px; height: 340px; display: flex; justify-content: center; align-items: center; }
        
        /* Ø§Ù„Ø³Ù‡Ù… (Ø§Ù„Ù…Ø¤Ø´Ø±) */
        .pointer { 
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; 
            border-left: 20px solid transparent; border-right: 20px solid transparent;
            border-top: 40px solid #ffd700; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø³Ù‡Ù… */
            z-index: 100; filter: drop-shadow(0 0 5px #000);
        }

        #wheelCanvas { width: 100%; height: 100%; border: 8px solid #d4af37; border-radius: 50%; box-shadow: 0 0 30px rgba(212,175,55,0.4); transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ù‡Ø§Ù† */
        .bet-section { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .bet-circle { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #d4af37; display: flex; align-items: center; justify-content: center; font-weight: 900; cursor: pointer; background: #111; }
        .bet-circle.active { background: #d4af37; color: #000; transform: scale(1.1); box-shadow: 0 0 10px #d4af37; }

        /* Ø²Ø± Ø§Ù„Ù„Ø¹Ø¨ */
        .play-btn { background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; width: 80%; max-width: 300px; padding: 15px; border-radius: 15px; font-size: 24px; font-weight: 900; border: none; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <audio id="spinSound" src="https://www.soundjay.com/misc/sounds/spinning-wheel-1.mp3"></audio>
    <audio id="winSound" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>
    <audio id="failSound" src="https://www.soundjay.com/button/sounds/button-10.mp3"></audio>

    <div class="top-bar">
        <div class="balance-chip">ğŸ’° <span id="uBalance">0</span></div>
        <div class="user-id"><span id="uName">...</span> ğŸ‘¤</div>
    </div>

    <div class="wheel-box">
        <div class="pointer"></div> <canvas id="wheelCanvas" width="500" height="500"></canvas>
    </div>

    <div class="bet-section">
        <div class="bet-circle" onclick="selectBet(1000, this)">1000</div>
        <div class="bet-circle" onclick="selectBet(500, this)">500</div>
        <div class="bet-circle active" onclick="selectBet(100, this)">100</div>
    </div>

    <button class="play-btn" id="spinBtn" onclick="startSpin()">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© ğŸ°</button>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let pName = localStorage.getItem('pName') || "Ù„Ø§Ø¹Ø¨";
        let score = 0, currentBet = 100, isSpinning = false;
        document.getElementById('uName').innerText = pName;

        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('uBalance').innerText = score; }
        });

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const prizes = ["Ø­Ø¸ Ø£ÙˆÙØ±", "100", "500", "1000", "5000", "1000", "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"];
        const colors = ["#800000", "#1a1a1a", "#d4af37", "#1a1a1a", "#d4af37", "#1a1a1a", "#444"];

        function drawWheel() {
            const arc = (Math.PI * 2) / prizes.length;
            for (let i = 0; i < prizes.length; i++) {
                const angle = i * arc;
                ctx.beginPath();
                ctx.fillStyle = colors[i];
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 250, angle, angle + arc);
                ctx.fill();
                ctx.save();
                ctx.translate(250, 250);
                ctx.rotate(angle + arc / 2);
                ctx.fillStyle = "#fff";
                ctx.font = "bold 24px Cairo";
                ctx.textAlign = "right";
                ctx.fillText(prizes[i], 230, 10);
                ctx.restore();
            }
        }
        drawWheel();

        function selectBet(amt, el) {
            if(isSpinning) return;
            currentBet = amt;
            document.querySelectorAll('.bet-circle').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
        }

        function startSpin() {
            if (isSpinning || score < currentBet) return;
            isSpinning = true;
            document.getElementById('spinSound').play();
            db.ref('players_logs/' + pName).update({ score: score - currentBet });

            const rotation = 3600 + Math.floor(Math.random() * 360);
            canvas.style.transform = `rotate(${rotation}deg)`;

            setTimeout(() => {
                isSpinning = false;
                const actualDeg = (rotation % 360);
                // Ø§Ù„Ø³Ù‡Ù… ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ (270 Ø¯Ø±Ø¬Ø©) Ù„Ø°Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„ÙŠÙ‡
                const prizeIndex = prizes.length - 1 - Math.floor(((actualDeg + 90) % 360) / (360 / prizes.length));
                const result = prizes[prizeIndex];
                
                if(!isNaN(result)) {
                    db.ref('players_logs/' + pName).update({ score: score + parseInt(result) });
                    document.getElementById('winSound').play();
                    alert("Ù…Ø¨Ø±ÙˆÙƒ ÙØ²Øª Ø¨Ù€ " + result);
                } else {
                    document.getElementById('failSound').play();
                    alert(result);
                }
                location.reload(); // Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙÙŠØ± Ø§Ù„Ø²ÙˆØ§ÙŠØ§
            }, 5000);
        }
    </script>
</body>
</html>
