<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¬Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© ğŸ¡</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background: #000; color: #fff; font-family: 'Cairo', sans-serif; text-align: center; margin: 0; overflow-x: hidden; }
        .header { padding: 20px; border-bottom: 2px solid #d4af37; background: #111; }
        .balance-box { font-size: 24px; color: #d4af37; font-weight: 900; margin: 10px 0; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø¬Ù„Ø© */
        .wheel-container { position: relative; width: 320px; height: 320px; margin: 40px auto; border: 5px solid #d4af37; border-radius: 50%; box-shadow: 0 0 20px #d4af37; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 40px; z-index: 10; filter: drop-shadow(0 0 5px #000); }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls { padding: 20px; }
        .bet-options { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .bet-btn { background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 10px 20px; border-radius: 10px; cursor: pointer; }
        .bet-btn.active { background: #d4af37; color: #000; font-weight: bold; border-color: #fff; }
        .spin-btn { background: linear-gradient(180deg, #d4af37, #8a6d3b); color: #000; padding: 15px 60px; border-radius: 50px; font-size: 22px; font-weight: 900; border: none; cursor: pointer; box-shadow: 0 5px 15px rgba(212,175,55,0.4); }
        .spin-btn:disabled { background: #333; color: #777; cursor: not-allowed; }
        .back-link { position: absolute; top: 15px; right: 15px; color: #d4af37; text-decoration: none; border: 1px solid #d4af37; padding: 5px 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back-link">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
        <h1>Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ¡</h1>
        <div class="balance-box">ğŸ’° Ø±ØµÙŠØ¯Ùƒ: <span id="userBalance">0</span></div>
    </div>

    <div class="wheel-container">
        <img src="https://i.ibb.co/3Ym9ZpC/pointer.png" class="pointer"> <img src="https://i.ibb.co/vVpxm75/wheel.png" id="wheel" style="transform: rotate(0deg);"> </div>

    <div class="controls">
        <div class="bet-options">
            <div class="bet-btn active" onclick="setBet(100, this)">100</div>
            <div class="bet-btn" onclick="setBet(500, this)">500</div>
            <div class="bet-btn" onclick="setBet(1000, this)">1000</div>
        </div>
        <button class="spin-btn" id="spinBtn" onclick="spinWheel()">Ø¥Ø¨Ø¯Ø£ Ø§Ù„Ù„Ù ğŸ°</button>
    </div>

    <audio id="sndSpin" src="https://www.soundjay.com/misc/sounds/spinning-wheel-1.mp3"></audio>
    <audio id="sndWin" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');
        let score = 0, currentBet = 100, isSpinning = false;

        if(!pName) window.location.href="index.html";

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙˆØ­Ø¯
        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ 
                score = s.val().score; 
                document.getElementById('userBalance').innerText = score; 
            }
        });

        function setBet(amt, el) {
            if(isSpinning) return;
            currentBet = amt;
            document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function spinWheel() {
            if(isSpinning || score < currentBet) {
                if(score < currentBet) alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ!");
                return;
            }

            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            db.ref('players_logs/' + pName).update({ score: score - currentBet });
            document.getElementById('sndSpin').play();

            // Ø­Ø³Ø§Ø¨ Ø²Ø§ÙˆÙŠØ© Ø¯ÙˆØ±Ø§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 5 Ù„ÙØ§Øª ÙƒØ§Ù…Ù„Ø©)
            const randomDegree = Math.floor(Math.random() * 360) + 1800; 
            const wheel = document.getElementById('wheel');
            wheel.style.transform = `rotate(${randomDegree}deg)`;

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                const actualDegree = randomDegree % 360;
                calculatePrize(actualDegree);
            }, 4000);
        }

        function calculatePrize(deg) {
            let winMultiplier = 0;
            // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¹Ø¬Ù„Ø© (Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ø¹Ø¬Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
            if (deg >= 0 && deg < 45) winMultiplier = 2;   // 2x
            else if (deg >= 45 && deg < 90) winMultiplier = 0;  // Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            else if (deg >= 90 && deg < 135) winMultiplier = 5; // 5x
            else if (deg >= 135 && deg < 180) winMultiplier = 0.5; // Ù†ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº
            else if (deg >= 180 && deg < 225) winMultiplier = 1.5; // 1.5x
            else if (deg >= 225 && deg < 270) winMultiplier = 0; // Ø­Ø¸ Ø£ÙˆÙØ±
            else if (deg >= 270 && deg < 315) winMultiplier = 10; // Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ 10x
            else winMultiplier = 1; // Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‡Ø§Ù†

            let totalWin = Math.floor(currentBet * winMultiplier);
            if(totalWin > 0) {
                db.ref('players_logs/' + pName).update({ score: score + totalWin });
                document.getElementById('sndWin').play();
                alert(`Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª Ø¨Ù€ ${totalWin} Ù†Ù‚Ø·Ø© ğŸ‰`);
            } else {
                alert("Ø­Ø¸ Ø£ÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©! ğŸ’”");
            }
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø¬Ù„Ø© ØªÙ‚Ù†ÙŠØ§Ù‹
            document.getElementById('wheel').style.transition = "none";
            document.getElementById('wheel').style.transform = `rotate(${deg}deg)`;
            setTimeout(() => { document.getElementById('wheel').style.transition = "transform 4s cubic-bezier(0.15, 0, 0.15, 1)"; }, 50);
        }
    </script>
</body>
</html>
