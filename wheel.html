<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¬Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© ğŸ¡</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Cairo', sans-serif; margin: 0; text-align: center; overflow: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar { display: flex; justify-content: space-between; padding: 15px; align-items: center; }
        .balance-chip { background: #111; border: 1px solid #d4af37; padding: 5px 15px; border-radius: 10px; color: #d4af37; font-weight: bold; }
        .user-id { display: flex; align-items: center; gap: 5px; color: #d4af37; }

        /* Ø§Ù„Ø¹Ø¬Ù„Ø© */
        .wheel-box { position: relative; margin: 20px auto; width: 320px; height: 320px; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; z-index: 10; }
        #wheelCanvas { width: 100%; height: 100%; border: 5px solid #d4af37; border-radius: 50%; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ù‡Ø§Ù† Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© */
        .bet-section { display: flex; justify-content: center; gap: 10px; margin-top: 50px; }
        .bet-circle { 
            width: 60px; height: 60px; border-radius: 50%; border: 2px solid #d4af37; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .bet-circle.active { background: #d4af37; color: #000; box-shadow: 0 0 15px #d4af37; }

        /* Ø²Ø± Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ± */
        .play-btn { 
            background: linear-gradient(to bottom, #ffd700, #b8860b); 
            color: #000; width: 60%; padding: 15px; border-radius: 15px; 
            font-size: 22px; font-weight: 900; border: none; margin-top: 25px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="balance-chip"><span id="uBalance">0</span> ğŸ’°</div>
        <div class="user-id"><span id="uName">Ø§Ø­Ù…Ø¯</span> ğŸ‘¤</div>
    </div>

    <div class="wheel-box">
        <img src="https://i.ibb.co/3Ym9ZpC/pointer.png" class="pointer" style="filter: brightness(1.5);">
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
    </div>

    <div class="bet-section">
        <div class="bet-circle" onclick="selectBet(10000, this)">10000</div>
        <div class="bet-circle" onclick="selectBet(5000, this)">5000</div>
        <div class="bet-circle" onclick="selectBet(1000, this)">1000</div>
        <div class="bet-circle" onclick="selectBet(500, this)">500</div>
        <div class="bet-circle active" onclick="selectBet(100, this)">100</div>
    </div>

    <button class="play-btn" id="spinBtn" onclick="startSpin()">Ø¥Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†</button>

    <script>
        const firebaseConfig = { databaseURL: "https://user-project-6c3bb-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let pName = localStorage.getItem('pName');
        let score = 0, currentBet = 100, isSpinning = false;

        document.getElementById('uName').innerText = pName;
        db.ref('players_logs/' + pName).on('value', s => {
            if(s.exists()){ score = s.val().score; document.getElementById('uBalance').innerText = score; }
        });

        // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ù†ÙØ³ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø©
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const prizes = ["200", "1000", "500", "2000", "5000", "10000", "Ø­Ø¸ Ø£ÙˆÙØ±"];
        const colors = ["#222", "#d4af37", "#222", "#d4af37", "#222", "#d4af37", "#800000"];

        function drawWheel() {
            const arc = (Math.PI * 2) / prizes.length;
            for (let i = 0; i < prizes.length; i++) {
                ctx.beginPath(); ctx.fillStyle = colors[i];
                ctx.moveTo(250, 250); ctx.arc(250, 250, 250, i * arc, (i + 1) * arc); ctx.fill();
                ctx.save(); ctx.translate(250, 250); ctx.rotate(i * arc + arc / 2);
                ctx.fillStyle = "#fff"; ctx.font = "bold 30px Cairo"; ctx.fillText(prizes[i], 120, 10);
                ctx.restore();
            }
        }
        drawWheel();

        function selectBet(amt, el) {
            if(isSpinning) return;
            currentBet = amt;
            document.querySelectorAll('.bet-circle').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
        }

        function startSpin() {
            if (isSpinning || score < currentBet) return;
            isSpinning = true;
            db.ref('players_logs/' + pName).update({ score: score - currentBet });

            const rotation = Math.floor(Math.random() * 360) + 3600;
            canvas.style.transform = `rotate(${rotation}deg)`;

            setTimeout(() => {
                isSpinning = false;
                const actualDeg = rotation % 360;
                const prizeIndex = prizes.length - 1 - Math.floor(actualDeg / (360 / prizes.length));
                let win = parseInt(prizes[prizeIndex]) || 0;
                if(win > 0) db.ref('players_logs/' + pName).update({ score: score + win });
                alert(win > 0 ? "Ù…Ø¨Ø±ÙˆÙƒ Ø±Ø¨Ø­Øª " + win : "Ø­Ø¸ Ø£ÙˆÙØ±!");
                canvas.style.transition = "none"; canvas.style.transform = `rotate(${actualDeg}deg)`;
                setTimeout(() => canvas.style.transition = "transform 4s cubic-bezier(0.15, 0, 0.15, 1)", 50);
            }, 4000);
        }
    </script>
</body>
</html>
